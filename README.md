# Pixiv Booth to freee Automation

[![Release](https://img.shields.io/github/v/release/qryuu/booth-freee-automator-repo?label=最新バージョン)](https://github.com/qryuu/booth-freee-automator-repo/releases/latest)

## 概要

このプロジェクトは、[Pixiv Booth](https://booth.pm/)からダウンロードした売上CSVを[会計freee](https://www.freee.co.jp/)に自動で取引登録するための、サーバーレスアプリケーションです。

手動での煩雑な入力作業をなくし、確定申告などの経理業務を効率化することを目的としています。

### 主な機能

* **S3トリガー:** 指定のS3バケットに売上CSVをアップロードするだけで、自動的に処理が開始されます。
* **複数商品注文の自動合算:** 1回の注文に複数の商品が含まれている場合でも、売上を正しく合算して1つの取引として登録します。
* **柔軟なヘッダー解析:** BOOTHの仕様変更（「手数料」から「サービス利用料」への名称変更など）を自動で判別し、新旧どちらのCSVフォーマットでも処理可能です。
* **安全な認証:** freee APIのOAuth 2.0リフレッシュトークンに対応しており、安全かつ継続的にAPIを利用できます。
* **サーバーレス:** AWS Lambda (`Node.js 22.x`ランタイム) をベースにしているため、低コストかつメンテナンスフリーで運用可能です。

### アーキテクチャ



---

## 🚀 Releases (配布ファイル)

ビルド済みのLambda関数 (`deployment.zip`) は、以下のリリースページからダウンロードできます。非エンジニアの方は、こちらをご利用ください。

➡️ [**v1.3.0 (最新仕様・複数商品対応版) をダウンロード**](https://github.com/qryuu/booth-freee-automator-repo/releases/latest)

---

## 📖 セットアップガイド

このプロジェクトは、AWSやAPIの知識レベルに応じて、2つのセットアップガイドを用意しています。

### 👩‍🎨 非エンジニアの方向け

AWSの画面操作だけでセットアップを完了できる、丁寧なガイドです。プログラムのコードを触る必要はありません。

➡️ [**Noteで続きを読む**](https://note.com/qryuu/n/n34ab87ef8c3a)

### 🛠️ エンジニアの方向け

ソースコードのカスタマイズや、より詳細な技術的背景を理解したい方向けのガイドです。

➡️ [**Qiitaで続きを読む**](https://qiita.com/qryuu/items/f63c023668f903956b08)

---

## 💻 開発とコントリビューション

このプロジェクトでは、Git Flowに基づいたブランチ戦略と、CI/CDによる自動ビルドを採用しています。

* `main`: 安定したリリースバージョンです。デフォルトブランチとして設定されています。
* `develop`: 開発ブランチです。機能追加やバグ修正のプルリクエストはここをターゲットにしてください。

### プルリクエスト時の注意
* デフォルトブランチが `main` のため、プルリクエスト作成時にはマージ先（baseブランチ）を **`develop`** に手動で切り替えてください。

---

## 使い方

1. **Pixiv Booth**から、月次の売上CSVファイルをダウンロードします。
2. セットアップ時に作成した**S3バケット**に、そのCSVファイルをアップロードします。
3. しばらく待つと、**会計freee**の取引一覧に、CSVの内容が自動で登録されます。

## 更新履歴

* **v1.3.0** (2026-01-04)
  * **BOOTH CSV仕様変更（「サービス利用料」への名称変更）に対応。**
  * 複数のヘッダー候補（サービス利用料、手数料など）を自動探索するフォールバックロジックを導入。
  * 将来的な項目名変更に対する頑健性を向上。
* **v1.2.0** (2025-10-03)
  * **複数商品を含む注文の会計ロジックを刷新。**
  * 同一注文番号の売上を合算し、正確な取引として登録する機能を追加。
* **v1.1.1** (2025-10-02)
  * 不正な日付データを含む行を安全にスキップするエラーハンドリングを追加。
* **v1.1.0** (2025-09-06)
  * Lambdaランタイムを **Node.js 22.x (LTS)** にアップデート。
* **v1.0.0** (2025-09-03)
  * 初回リリース。

## 注意事項

* このアプリケーションは、freee APIの仕様変更によって動作しなくなる可能性があります。
* freeeのリフレッシュトークンは定期的に失効する場合があります。その際は手順書に従い、AWS Secrets Managerの値を更新してください。

## ライセンス

このプロジェクトは[MITライセンス](LICENSE)の下で公開されています。
